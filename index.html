<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ ì§€ë³´ìˆ˜ ì´ê´„í‘œ</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto; /* ìë™ ë ˆì´ì•„ì›ƒ */
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            word-wrap: break-word;
            white-space: normal;
        }
        th {
            background-color: #f4f4f4;
        }
        .details {
            display: none;
            background-color: #f9f9f9;
        }
        button {
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
    <script>
        async function loadSheetData() {
            const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQhTDvyzxTI5sMY51vJl4haUj29610K3aCkTxG2XhU_ocnD-awkHNbIfTu3BnXYY3Tyz1i2JUylYH78/pub?gid=0&single=true&output=csv"; // Google Sheets CSV ë§í¬

            try {
                console.log("ğŸ”„ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...");
                const response = await fetch(sheetURL);
                if (!response.ok) throw new Error("ğŸ“¢ CSV íŒŒì¼ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");

                const data = await response.text();
                console.log("âœ… ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!");
                console.log("ğŸ“Œ CSV ë°ì´í„°:", data);

                // ğŸ”¹ CSV ë°ì´í„° íŒŒì‹± (ì‰¼í‘œ ë¬¸ì œ í•´ê²°)
                const rows = data.split("\n").map(row => row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g));
                if (rows.length < 2) throw new Error("âŒ ë°ì´í„°ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤!");

                let tableHTML = "<table><tr>";

                // ğŸ”¹ **í—¤ë” ìƒì„±**
                rows[0].forEach(header => {
                    tableHTML += `<th>${header.replace(/"/g, "").trim()}</th>`; // í°ë”°ì˜´í‘œ ì œê±°
                });
                tableHTML += "<th>ë”ë³´ê¸°</th></tr>";

                // ğŸ”¹ **ë°ì´í„° í–‰ ì¶”ê°€**
                for (let i = 1; i < rows.length; i++) {
                    let rowData = rows[i].map(cell => cell ? cell.replace(/"/g, "").trim() : ""); // ë¹ˆ ê°’ ì²˜ë¦¬

                    tableHTML += `<tr>`;
                    for (let j = 0; j < rowData.length - 1; j++) {
                        tableHTML += `<td>${rowData[j]}</td>`;
                    }
                    tableHTML += `<td><button onclick="toggleDetails(${i})">ìƒì„¸ë³´ê¸°</button></td></tr>`;

                    // ğŸ”¹ **ìƒì„¸ ì •ë³´ ì¶”ê°€ (ìˆ¨ê²¨ì§„ div)**
                    let detailsData = rowData[rowData.length - 1].split(";"); // `;`ë¡œ êµ¬ë¶„ëœ ìƒì„¸ ì •ë³´
                    let detailsHTML = "<table border='1' width='100%'>";
                    detailsData.forEach(detail => {
                        let [key, value] = detail.split(":");
                        detailsHTML += `<tr><td>${key}</td><td>${value}</td></tr>`;
                    });
                    detailsHTML += "</table>";

                    tableHTML += `<tr id="details-${i}" class="details"><td colspan="${rowData.length}">
                        ${detailsHTML}
                    </td></tr>`;
                }

                tableHTML += "</table>";
                document.getElementById("sheetTable").innerHTML = tableHTML;
            } catch (error) {
                console.error(error.message);
                document.getElementById("sheetTable").innerHTML = "<p>âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
            }
        }

        function toggleDetails(index) {
            let detailsRow = document.getElementById(`details-${index}`);
            detailsRow.style.display = (detailsRow.style.display === "none" || detailsRow.style.display === "") ? "table-row" : "none";
        }
    </script>
</head>
<body onload="loadSheetData()">
    <h1>ìœ ì§€ë³´ìˆ˜ ì´ê´„í‘œ</h1>
    <div id="sheetTable">Loading...</div>
</body>
</html>
